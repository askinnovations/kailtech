import { useEffect, useState } from "react";
import { useNavigate } from "react-router";
import axios from "utils/axios";
import { toast } from "sonner";
import { Input, Button } from "components/ui";
import { Page } from "components/shared/Page";
import ReactSelect from "react-select";

export default function AddInwardEntry() {
  const navigate = useNavigate();

  const [formData, setFormData] = useState({
    inwarddate: "",
    sample_received_date: "",
    ctype: "",
    customerid: "",
    specificpurpose: "",
    report_customer_id: "",
    customer_address: "",
    billing_customer_id: "",
    billing_address: "",
    gst_no: "",
    concern_person_id: "",
    quotation_no: "",
    bd: "",
    promoter: "",
    priority: "",
    approval: "",
    pcharges: "",
    pchargestype: "",
    ponumber: "",
    wupload: null,
    modeofreciept: "",
    couriernamerec: "",
    dateofdispatchrec: "",
    docketnorec: "",
    localcontactrec: "",
    rupload: null,
    modeofdispatch: "",
    couriername: "",
    dateofdispatch: "",
    docketno: "",
    localcontact: "",

    paymentstatus: "2", // Default "No"
    modeofpayment: "",
    detailsofpayment: "",
    paymentamount: "",
    certcollectiondetail: "",
    additionalemail: "",
    certcollectionremark: "",
    documents: "",
    deadline: "",
    specialrequest: "",
    notes: "",
    nablrequired: "Yes", // default ‚Äì you can control based on conditions
    calibacc: "Nabl",
    instrumentlocation: "Lab",
    caliblocation: "Lab",
  });

  const [certificateOptions, setCertificateOptions] = useState([]);
  const [customerTypeOptions, setCustomerTypeOptions] = useState([]);
  const [specificPurposeOptions, setSpecificPurposeOptions] = useState([]);
  const [customerOptions, setCustomerOptions] = useState([]);
  const [reportAddressOptions, setReportAddressOptions] = useState([]);
  const [billingAddressOptions, setBillingAddressOptions] = useState([]);
  const [quotationOptions, setQuotationOptions] = useState([]);
  const [modeOptions, setModeOptions] = useState([]);
  const [modepaymnetOptions, setModePaymentOptions] = useState([]);
  const [bdOptions, setBdOptions] = useState([]);
  const [promoterOptions, setPromoterOptions] = useState([]);
  const [approvedByOptions, setApprovedByOptions] = useState([]);
  const [choiceOptions, setChoiceOptions] = useState([]);
  const [concernPersonOptions, setConcernPersonOptions] = useState([]);
  const [selectedConcernPerson, setSelectedConcernPerson] = useState({
    designation: "",
    email: "",
    mobile: "",
  });
  const [creditInfo, setCreditInfo] = useState({ days: 0, amount: 0 });
  const [loading, setLoading] = useState(false);
  const isTransportMode = formData.modeofreciept !== "1"; // '1' = By Hand
  const isTransportDispatchMode = formData.modeofdispatch !== "BY Hand";


  useEffect(() => {
    const fetchDropdowns = async () => {
      try {
        const [
          typeRes,
          purposeRes,
          customerRes,
          bdRes,
          promoterRes,
          choiceRes,
          approvedRes,
          modeRes,
          paymentmodeRes,
          setCertificateRes,
        ] = await Promise.all([
          axios.get("/people/get-customer-type-list"),
          axios.get("/people/get-specific-purpose-list"),
          axios.get("/people/get-all-customers"),
          axios.get("/people/get-customer-bd"),
          axios.get("/people/list-promoters"),
          axios.get("/get-choices"),
          axios.get("/approved-by"),
          axios.get("/mode-of-receipt"),
          axios.get("/mode-of-payment"),
          axios.get("/certificate-collect-as"),
        ]);

        setCustomerTypeOptions(
          (typeRes?.data?.Data || []).map((item) => ({
            label: item.name,
            value: item.id,
          })),
        );

        setSpecificPurposeOptions(
          (purposeRes?.data?.data || []).map((item) => ({
            label: item.name,
            value: item.id,
          })),
        );

        setCustomerOptions(
          (customerRes?.data?.data || []).map((item) => ({
            label: `${item.name} (${item.mobile})`,
            value: item.id,
            creditdays: item.creditdays,
            creditamount: item.creditamount,
            gst_no: item.gstno || "",
          })),
        );

        setBdOptions(
          (bdRes?.data?.data || []).map((item) => ({
            label: `${item.firstname} ${item.lastname}`,
            value: item.id,
          })),
        );
        setPromoterOptions(
          (promoterRes?.data?.data || []).map((item) => ({
            label: `${item.name}`,
            value: item.id,
          })),
        );

        setChoiceOptions(
          (choiceRes?.data?.data || []).map((item) => ({
            label: item.name,
            value: item.id,
          })),
        );

        setApprovedByOptions(
          (approvedRes?.data?.data || []).map((item) => ({
            label: `${item.firstname} ${item.lastname}`,
            value: item.id,
          })),
        );

        setModeOptions(
          (modeRes?.data?.data || []).map((item) => ({
            label: item.name,
            value: item.id,
          })),
        );

        setModePaymentOptions(
          (paymentmodeRes?.data?.data || []).map((item) => ({
            label: item.name,
            value: item.id,
          })),
        );
        setCertificateOptions(
          (setCertificateRes?.data?.data || []).map((item) => ({
            label: item.name,
            value: item.id,
          })),
        );
      } catch (error) {
        toast.error("Error loading dropdowns");
        console.error(error);
      }
    };

    fetchDropdowns();
  }, []);

  

  const handleChange = (e) => {
    const { name, value } = e.target;

    const dateFields = [
      "inwarddate",
      "sample_received_on",
      "dateofdispatchrec",
      "dateofdispatch",
      "deadline",
    ];

    if (dateFields.includes(name) && value) {
      const [year, month, day] = value.split("-");
      const formattedDate = `${day}-${month}-${year}`;
      setFormData((prev) => ({
        ...prev,
        [name]: formattedDate,
      }));
    } else {
      setFormData((prev) => ({
        ...prev,
        [name]: value,
      }));
    }

  };


  const handleSelectChange = (option, name) => {
    setFormData((prev) => ({ ...prev, [name]: option?.value || "" }));

    if (name === "customerid" && option) {
      setCreditInfo({
        days: option.creditdays || 0,
        amount: option.creditamount || 0,
      });

      // ‚úÖ Set GST No from selected customer
      setFormData((prev) => ({
        ...prev,
        gst_no: option.gst_no || "", // auto-fill but editable
      }));

      fetchConcernPersons(option.value);
      fetchQuotations(option.value); // üîÅ Call quotation list
    }

    if (name === "report_customer_id" && option?.value) {
      fetchCustomerAddresses(option.value, "report");
    }

    if (name === "billing_customer_id" && option?.value) {
      fetchCustomerAddresses(option.value, "billing");
    }

    if (
      (name === "report_customer_id" || name === "billing_customer_id") &&
      !option
    ) {
      if (name === "report_customer_id") {
        setReportAddressOptions([]);
        setFormData((prev) => ({ ...prev, customer_address: "" }));
      } else {
        setBillingAddressOptions([]);
        setFormData((prev) => ({ ...prev, billing_address: "" }));
      }
    }
    if (name === "customerid" && !option) {
      setConcernPersonOptions([]);
      setFormData((prev) => ({ ...prev, concern_person_id: "" }));
      setSelectedConcernPerson({ designation: "", email: "", mobile: "" });
    }
    
    if (name === "concern_person_id" && option) {
      fetchConcernPersonDetails(option.value);
    }
  };

  const fetchCustomerAddresses = async (customerId, type) => {
    try {
      const res = await axios.get(
        `/people/get-customers-address/${customerId}`,
      );
      const addresses = res?.data?.data || [];
      const options = addresses.map((item) => ({
        label: `${item.name}, ${item.address}, ${item.city} - ${item.pincode}`,
        value: item.id,
      }));

      if (type === "report") setReportAddressOptions(options);
      if (type === "billing") setBillingAddressOptions(options);
    } catch (err) {
      toast.error("Failed to fetch customer addresses");
      console.error(err);
    }
  };

  const fetchConcernPersons = async (customerId) => {
    try {
      const res = await axios.get(`/get-concern-person/${customerId}`);
      const list = res?.data?.data || [];
      setConcernPersonOptions(
        list.map((item) => ({
          label: item.name,
          value: item.id,
          designation: item.designation,
          email: item.email,
          mobile: item.mobile,
        })),
      );
    } catch (err) {
      toast.error("Failed to fetch concern persons");
      console.error(err);
    }
  };
  //  fetchConcernPersonDetails
  const fetchConcernPersonDetails = async (personId) => {
    try {
      const res = await axios.get(`/get-concern-person-details/${personId}`);
      const data = res?.data?.data;

      if (data) {
        setSelectedConcernPerson({
          designation: data.designation || "",
          email: data.email || "",
          mobile: data.mobile || "",
        });
      }
    } catch (err) {
      toast.error("Failed to fetch concern person details");
      console.error(err);
    }
  };

  // fetchQuotations
  const fetchQuotations = async (customerId) => {
    try {
      const res = await axios.get(`/get-quotaion/${customerId}`);
      const data = res?.data?.data || [];

      setQuotationOptions(
        data.map((item) => ({
          label: `${String(item.id).padStart(5, "0")}`,
          value: item.id, 
        })),
      );
    } catch (err) {
      toast.error("Failed to fetch quotations");
      console.error(err);
    }
  };

  const handleSameAsReporting = () => {
    setFormData((prev) => ({
      ...prev,
      billing_customer_id: prev.report_customer_id,
      billing_address: prev.customer_address,
    }));
    setBillingAddressOptions(reportAddressOptions);
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);

    try {
      const form = new FormData();

      // Loop through formData and append
      for (const key in formData) {
        if (formData[key] !== null && formData[key] !== undefined) {
          form.append(key, formData[key]);
        }
      }

      const res = await axios.post(
        "/calibrationprocess/add-inward-entry",
        form,
      );

      if (
        String(res.data.status) === "true" ||
        String(res.data.status) === "1"
      ) {
        toast.success("Inward Entry Saved ‚úÖ", {
          duration: 1200,
          icon: "‚úÖ",
        });
        navigate("/dashboards/calibration-process/inward-entry-lab");
      } else {
        toast.error(res.data.message || "Failed to save entry ‚ùå");
      }
    } catch (err) {
      console.error("Error saving inward entry:", err);
      toast.error(err?.response?.data?.message || "Something went wrong ‚ùå");
    } finally {
      setLoading(false);
    }
  };


  return (
    <Page title="Add Inward Entry">
      <div className="p-6">
        <form
          onSubmit={handleSubmit}
          className="grid grid-cols-1 gap-4 md:grid-cols-2"
        >
          <Input
            label="Date"
            name="inwarddate"
            type="date"
            onChange={handleChange}
            required
          />
          <Input
            label="Sample Received Date"
            name="sample_received_on"
            type="date"
            onChange={handleChange}
          />
          <div>
            <label className="block text-sm font-medium">Customer Type</label>
            <ReactSelect
              name="ctype"
              options={customerTypeOptions}
              onChange={(option) => handleSelectChange(option, "ctype")}
              placeholder="Select Customer Type"
            />
          </div>
          <div>
            <label className="block text-sm font-medium">Customer</label>
            <ReactSelect
              name="customerid"
              options={customerOptions}
              onChange={(option) => handleSelectChange(option, "customerid")}
              placeholder="Select Customer"
            />
          </div>
          <div>
            <label className="block text-sm font-medium">
              Specific Purpose
            </label>
            <ReactSelect
              name="specificpurpose"
              options={specificPurposeOptions}
              onChange={(option) =>
                handleSelectChange(option, "specificpurpose")
              }
              placeholder="Select Purpose"
            />
          </div>
          <div className="col-span-2">
            <p className="text-sm font-medium">
              <strong>Customer Credit:</strong> {creditInfo.days} Days | ‚Çπ{" "}
              {creditInfo.amount}
            </p>
          </div>
          {/* Report Details */}
          <div className="col-span-2 mt-4 border-t pt-4">
            <h3 className="text-md mb-2 font-semibold">
              Customer&apos;s Report Detail
            </h3>
            <div className="grid grid-cols-1 gap-4 md:grid-cols-2">
              <div>
                <label className="block text-sm font-medium">
                  Customer Name
                </label>
                <ReactSelect
                  name="report_customer_id"
                  options={customerOptions}
                  onChange={(option) =>
                    handleSelectChange(option, "report_customer_id")
                  }
                  placeholder="Select Customer"
                />
              </div>
              <div>
                <label className="block text-sm font-medium">
                  Customer Address
                </label>
                <ReactSelect
                  name="customer_address"
                  options={reportAddressOptions}
                  onChange={(option) =>
                    setFormData((prev) => ({
                      ...prev,
                      customer_address: option?.value || "",
                    }))
                  }
                  placeholder="Select Address"
                  isDisabled={reportAddressOptions.length === 0}
                />
              </div>
            </div>
          </div>
          {/* Billing Details */}
          <div className="col-span-2 mt-4 border-t pt-4">
            <div className="mb-2 flex items-center justify-between">
              <h3 className="text-md font-semibold">
                Customer&apos;s Billing Detail
              </h3>
              <button
                type="button"
                className="text-sm text-blue-600 underline"
                onClick={handleSameAsReporting}
              >
                Same as reporting
              </button>
            </div>

            <div className="grid grid-cols-1 gap-4 md:grid-cols-2">
              <div>
                <label className="block text-sm font-medium">
                  Customer Name
                </label>
                <ReactSelect
                  name="billing_customer_id"
                  options={customerOptions}
                  value={
                    customerOptions.find(
                      (opt) => opt.value === formData.billing_customer_id,
                    ) || null
                  }
                  onChange={(option) =>
                    handleSelectChange(option, "billing_customer_id")
                  }
                  placeholder="Select Customer"
                />
              </div>

              <div>
                <label className="block text-sm font-medium">
                  Customer Address
                </label>
                <ReactSelect
                  name="billing_address"
                  options={billingAddressOptions}
                  value={
                    billingAddressOptions.find(
                      (opt) => opt.value === formData.billing_address,
                    ) || null
                  }
                  onChange={(option) =>
                    setFormData((prev) => ({
                      ...prev,
                      billing_address: option?.value || "",
                    }))
                  }
                  placeholder="Select Address"
                  isDisabled={billingAddressOptions.length === 0}
                />
              </div>

              <div>
                <Input
                  label="GST No"
                  name="gst_no"
                  value={formData.gst_no}
                  onChange={handleChange}
                />
              </div>
            </div>
          </div>
          {/* Concern Person Section */}
          <div className="col-span-2 mt-4 border-t pt-4">
            <h3 className="text-md mb-2 font-semibold">Concern Person</h3>
            <div className="grid grid-cols-1 gap-4 md:grid-cols-2">
              <div>
                <label className="block text-sm font-medium">
                  Concern Person Name
                </label>
                <ReactSelect
                  name="concern_person_id"
                  options={concernPersonOptions}
                  onChange={(option) =>
                    handleSelectChange(option, "concern_person_id")
                  }
                  placeholder="Select Concern Person"
                />
              </div>

              {formData.concern_person_id && (
                <>
                  <Input
                    label="Concern Person Designation"
                    name="concern_designation"
                    value={selectedConcernPerson.designation}
                    disabled
                  />
                  <Input
                    label="Concern Person Email"
                    name="concern_email"
                    value={selectedConcernPerson.email}
                    disabled
                  />
                  <Input
                    label="Concern Person Mobile"
                    name="concern_mobile"
                    value={selectedConcernPerson.mobile}
                    disabled
                  />
                </>
              )}
            </div>
          </div>
          {/* Quotation NO*/}
          <div>
            <label className="block text-sm font-medium">Quotation No</label>
            <ReactSelect
              name="quotation_no"
              options={quotationOptions}
              onChange={(option) =>
                setFormData((prev) => ({
                  ...prev,
                  quotation_no: option?.value || "",
                }))
              }
              placeholder="Select Quotation"
              isDisabled={quotationOptions.length === 0}
            />
          </div>
          {/* Concerned */}
          <div>
            <label className="block text-sm font-medium">Concerned BD</label>
            <ReactSelect
              name="bd"
              options={bdOptions}
              value={bdOptions.find((opt) => opt.value === formData.bd) || null}
              onChange={(option) =>
                setFormData((prev) => ({
                  ...prev,
                  bd: option?.value || "",
                }))
              }
              placeholder="Select BD"
              isDisabled={bdOptions.length === 0}
            />
          </div>
          <div>
            <label className="block text-sm font-medium">Promoter</label>
            <ReactSelect
              name="promoter"
              options={promoterOptions}
              value={
                promoterOptions.find(
                  (opt) => opt.value === formData.promoter,
                ) || null
              }
              onChange={(option) =>
                setFormData((prev) => ({
                  ...prev,
                  promoter: option?.value || "",
                }))
              }
              placeholder="Select Promoter"
              isDisabled={promoterOptions.length === 0}
            />
          </div>
          <div>
            <label className="block text-sm font-medium">Priority Sample</label>
            <ReactSelect
              name="priority"
              options={choiceOptions}
              value={
                choiceOptions.find((opt) => opt.value === formData.priority) ||
                null
              }
              onChange={(option) =>
                setFormData((prev) => ({
                  ...prev,
                  priority: option?.value || "",
                }))
              }
              placeholder="Select Choice"
              isDisabled={choiceOptions.length === 0}
            />
          </div>
          <div>
            <label className="block text-sm font-medium">Approved By</label>
            <ReactSelect
              name="approval"
              options={approvedByOptions}
              value={
                approvedByOptions.find(
                  (opt) => opt.value === formData.approval,
                ) || null
              }
              onChange={(option) =>
                setFormData((prev) => ({
                  ...prev,
                  approval: option?.value || "",
                }))
              }
              placeholder="Select Approver"
              isDisabled={approvedByOptions.length === 0}
            />
          </div>
          {/*   Priority Testing Charges */}
          <div className="grid grid-cols-3 items-center gap-4">
            {/* Label */}
            <label className="col-span-1 text-sm font-medium">
              Priority Testing Charges
            </label>

            {/* pcharges Input */}
            <input
              type="number"
              value={formData.pcharges}
              onChange={(e) =>
                setFormData((prev) => ({
                  ...prev,
                  pcharges: e.target.value,
                }))
              }
              className="col-span-1 rounded border px-3 py-1"
              placeholder="Enter charges"
            />

            {/* pchargestype Dropdown */}
            <select
              value={formData.pchargestype || "%"}
              onChange={(e) =>
                setFormData((prev) => ({
                  ...prev,
                  pchargestype: e.target.value,
                }))
              }
              className="col-span-1 rounded border px-3 py-1"
            >
              <option value="%">%</option>
              <option value="‚Çπ">‚Çπ</option>
            </select>
          </div>
          {/* Work Order No */}
          <div>
            <label className="mb-1 block text-sm font-medium">
              Work Order No
            </label>
            <input
              type="text"
              name="ponumber"
              value={formData.ponumber || ""}
              onChange={(e) =>
                setFormData((prev) => ({
                  ...prev,
                  ponumber: e.target.value,
                }))
              }
              className="w-full rounded border px-3 py-2"
              placeholder="Enter Work Order No"
            />
          </div>
          {/* Work Order Upload */}
          <div>
            <label className="mb-1 block text-sm font-medium">
              Work Order Upload
            </label>
            <input
              type="file"
              name="wupload"
              onChange={(e) =>
                setFormData((prev) => ({
                  ...prev,
                  wupload: e.target.files[0],
                }))
              }
              className="block w-full rounded border px-3 py-2"
            />
          </div>

        
          {/* Mode Of Receipt Dropdown */}
          <div>
            <label className="mb-1 block text-sm font-medium">
              Mode Of Receipt
            </label>
            <select
              name="modeofreciept"
              value={formData.modeofreciept}
              onChange={(e) =>
                setFormData((prev) => ({
                  ...prev,
                  modeofreciept: e.target.value,
                }))
              }
              className="w-full rounded border px-3 py-2"
            >
              <option value="">Select Mode</option>
              {modeOptions.map((opt) => (
                <option key={opt.value} value={opt.value}>
                  {opt.label}
                </option>
              ))}
            </select>
          </div>

          {/* Conditionally Show: Only if mode is NOT "By Hand" */}
          {isTransportMode && (
            <div className="mt-4 grid grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium">
                  Courier/Cargo/Transport
                </label>
                <input
                  type="text"
                  name="couriernamerec"
                  value={formData.couriernamerec}
                  onChange={handleChange}
                  className="w-full rounded border px-3 py-2"
                />
              </div>

              <div>
                <label className="block text-sm font-medium">
                  Date Of Dispatch
                </label>
                <input
                  type="date"
                  name="dateofdispatchrec"
                  value={formData.dateofdispatchrec}
                  onChange={handleChange}
                  className="w-full rounded border px-3 py-2"
                />
              </div>

              <div>
                <label className="block text-sm font-medium">
                  Docket/Airway Bill No
                </label>
                <input
                  type="text"
                  name="docketnorec"
                  value={formData.docketnorec}
                  onChange={handleChange}
                  className="w-full rounded border px-3 py-2"
                />
              </div>

              <div>
                <label className="block text-sm font-medium">
                  Local Contact of Courier
                </label>
                <input
                  type="text"
                  name="localcontactrec"
                  value={formData.localcontactrec}
                  onChange={handleChange}
                  className="w-full rounded border px-3 py-2"
                />
              </div>
            </div>
          )}

          {/* Receipt Doc Upload */}
          <div>
            <label className="mb-1 block text-sm font-medium">
              Receipt Doc Upload
            </label>
            <input
              type="file"
              name="rupload"
              onChange={(e) =>
                setFormData((prev) => ({
                  ...prev,
                  rupload: e.target.files[0],
                }))
              }
              className="block w-full rounded border px-3 py-2"
            />
          </div>

          <div>
            <label className="mb-1 block text-sm font-medium">
              Mode Of Return
            </label>
            <select
              name="modeofdispatch"
              value={formData.modeofdispatch || ""}
              onChange={(e) =>
                setFormData((prev) => ({
                  ...prev,
                  modeofdispatch: e.target.value,
                }))
              }
              required
              className="w-full rounded border px-3 py-2"
            >
              <option value="">Select Mode</option>
              <option value="BY Hand">BY Hand</option>
              <option value="by Courier/Cargo/Transport">
                by Courier/Cargo/Transport
              </option>
            </select>
          </div>

          {isTransportDispatchMode && (
            <div className="mt-4 grid grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium">
                  Courier/Cargo/Transport
                </label>
                <input
                  type="text"
                  name="couriername"
                  value={formData.couriername || ""}
                  onChange={handleChange}
                  className="w-full rounded border px-3 py-2"
                />
              </div>

              <div>
                <label className="block text-sm font-medium">
                  Date Of Dispatch
                </label>
                <input
                  type="date"
                  name="dateofdispatch"
                  value={formData.dateofdispatch || ""}
                  onChange={handleChange}
                  className="w-full rounded border px-3 py-2"
                />
              </div>

              <div>
                <label className="block text-sm font-medium">
                  Docket/Airway Bill No
                </label>
                <input
                  type="text"
                  name="docketno"
                  value={formData.docketno || ""}
                  onChange={handleChange}
                  className="w-full rounded border px-3 py-2"
                />
              </div>

              <div>
                <label className="block text-sm font-medium">
                  Local Contact of Courier
                </label>
                <input
                  type="text"
                  name="localcontact"
                  value={formData.localcontact || ""}
                  onChange={handleChange}
                  className="w-full rounded border px-3 py-2"
                />
              </div>
            </div>
          )}

          <div>
            <label className="mb-1 block text-sm font-medium">
              Is Payment Done?
            </label>
            <select
              name="paymentstatus"
              value={formData.paymentstatus}
              onChange={handleChange}
              className="w-full rounded border px-3 py-2"
            >
              <option value="2">No</option>
              <option value="1">Yes</option>
            </select>
          </div>
          {formData.paymentstatus === "1" && (
            <div>
              <label className="mb-1 block text-sm font-medium">
                Mode of Payment
              </label>
              <select
                name="modeofpayment"
                value={formData.modepaymnetOptions}
                onChange={handleChange}
                className="w-full rounded border px-3 py-2"
              >
                <option value="">Select Payment Mode</option>
                {modepaymnetOptions.map((item) => (
                  <option key={item.value} value={item.value}>
                    {item.label}
                  </option>
                ))}
              </select>
              <div>
                <label className="mb-1 block text-sm font-medium">
                  Details
                </label>
                <input
                  type="text"
                  name="detailsofpayment"
                  value={formData.detailsofpayment}
                  onChange={handleChange}
                  className="w-full rounded border px-3 py-2"
                  placeholder="Enter payment details"
                />
              </div>

              <div>
                <label className="block text-sm font-medium">Amount</label>
                <input
                  type="number"
                  name="paymentamount"
                  value={formData.paymentamount}
                  onChange={handleChange}
                  className="w-full rounded border px-3 py-2"
                  placeholder="Enter amount"
                />
              </div>
            </div>
          )}
          {/* CERTIFICATE COLLECTION DETAILS (Please tick) */}
          <div className="mt-8 space-y-6">
          
            <div>
              <label className="block text-sm font-medium">
                Certificate Collect as
              </label>
              <select
                name="certcollectiondetail"
                value={formData.certcollectiondetail}
                onChange={(e) =>
                  setFormData({
                    ...formData,
                    certcollectiondetail: e.target.value,
                  })
                }
                className="w-full rounded border px-3 py-2"
              >
                <option value="">Select</option>
                {certificateOptions.map((item) => (
                  <option key={item.value} value={item.value}>
                    {item.label}
                  </option>
                ))}
              </select>
            </div>

            {/* Additional Email Ids */}
            <div>
              <label className="block text-sm font-medium">
                Additional Email Ids
              </label>
              <textarea
                name="additionalemail"
                value={formData.additionalemail}
                onChange={(e) =>
                  setFormData({ ...formData, additionalemail: e.target.value })
                }
                className="w-full rounded border px-3 py-2"
                placeholder="Comma separated additional emails"
              ></textarea>
            </div>

            {/* Description */}
            <div>
              <label className="block text-sm font-medium">Description</label>
              <input
                type="text"
                name="certcollectionremark"
                value={formData.certcollectionremark}
                onChange={(e) =>
                  setFormData({
                    ...formData,
                    certcollectionremark: e.target.value,
                  })
                }
                className="w-full rounded border px-3 py-2"
                placeholder="Enter description"
              />
            </div>
          </div>
          {/* SPECIAL INSTRUCTIONS */}
          <div className="mt-8 space-y-6">
            {/* Documents Submitted */}
            <div>
              <label className="block text-sm font-medium">
                Documents Submitted, if any (Details)
              </label>
              <input
                type="text"
                name="documents"
                value={formData.documents}
                onChange={(e) =>
                  setFormData({ ...formData, documents: e.target.value })
                }
                className="w-full rounded border px-3 py-2"
                placeholder="Certificate Collection Remark"
              />
            </div>

            {/* Deadline */}
            <div>
              <label className="block text-sm font-medium">Any Deadline</label>
              <input
                type="date"
                name="deadline"
                value={formData.deadline}
                onChange={(e) =>
                  setFormData({ ...formData, deadline: e.target.value })
                }
                className="w-full rounded border px-3 py-2"
                min={new Date().toISOString().split("T")[0]} // disables past dates
              />
            </div>

            {/* Special Request */}
            <div>
              <label className="block text-sm font-medium">
                Any Special Request
              </label>
              <textarea
                name="specialrequest"
                value={formData.specialrequest}
                onChange={(e) =>
                  setFormData({ ...formData, specialrequest: e.target.value })
                }
                className="w-full rounded border px-3 py-2"
                placeholder="terms"
              ></textarea>
            </div>

            <hr />

            {/* Notes */}
            <div>
              <label className="block text-sm font-medium">Notes</label>
              <textarea
                name="notes"
                value={formData.notes}
                onChange={(e) =>
                  setFormData({ ...formData, notes: e.target.value })
                }
                className="w-full rounded border px-3 py-2"
                placeholder="terms"
              ></textarea>
            </div>

            {/* Hidden Inputs (stored in formData) */}
            <input
              type="hidden"
              name="nablrequired"
              value={formData.nablrequired}
            />
            <input type="hidden" name="calibacc" value={formData.calibacc} />
            <input
              type="hidden"
              name="instrumentlocation"
              value={formData.instrumentlocation}
            />
            <input
              type="hidden"
              name="caliblocation"
              value={formData.caliblocation}
            />
          </div>

          <div className="col-span-1 md:col-span-2">
            <Button type="submit" color="primary" disabled={loading}>
              {loading ? "Saving..." : "Save"}
            </Button>
          </div>
        </form>
      </div>
    </Page>
  );
}
